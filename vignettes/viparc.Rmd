---
title: "Introduction to viparc"
author: "Marc Choisy"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::knit_hooks$set(margin = function(before, options, envir) {
  if (before) par(mgp = c(1.5, .5, 0), bty = "n", plt = c(.105, .97, .13, .97))
  else NULL
})

knitr::opts_chunk$set(margin = TRUE, prompt = TRUE, comment = "#>",
                      collapse = TRUE, cache = FALSE, autodep = TRUE,
                      dev.args = list(pointsize = 11), fig.height = 3.5,
                      fig.width = 4.24725, fig.retina = 2,
                      fig.align = "center", fig.path = "README-")
```

## Packages

```{r message = FALSE}
library(viparc)
library(dplyr)
```

## Heatmap figure

Heatmap of the surveillance disease and drug usage in several farms for a 
number of weeks:

```{r message = FALSE, eval = FALSE}
data("chcknfarms")
chcknfarms %>%
  filter(CYCLE == 1) %>%
  transmute(space   = FARMCODE,
            time    = WEEK,
            disease = SRespiratory,
            drug    = AntibioticUse) %>%
  heat_map()
```

Note that the input data frame to `heat_map` should have 4 variables named
`space`, `time`, `disease` and `drug`.


## Identifying weeks with no AMU

Let's consider for example the following vector of AMU:

```{r}
amu <- rep(rep(c(TRUE, FALSE), 6), c(7, 2, 1, 2, 3, 1, 2, 1, 1, 1, 1, 3))
```

See this example:

```{r}
data.frame(amu) %>%
  mutate(
    with_amu = amu,
    wout_amu = no_amu(amu, 1)) %>%
  select(-amu)
```

Note that, as expected, the only combination that we cannot have on any row is
`c(TRUE, TRUE)`. Then, if one wants to discriminate any week either into AMU or
no-AMU, the code will have to be:

```{r}
data.frame(amu) %>%
  mutate(
    with_amu = amu,
    wout_amu = no_amu(amu, 1)) %>%
  select(-amu) %>% 
  filter(with_amu + wout_amu > 0)
```

